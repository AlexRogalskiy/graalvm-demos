# Spring Boot Native Image Microservice Demo

## Overview

This demo / sample shows you how to build a simple micro-service using Spring Boot that is packaged and deployed as 
GraalVM Native Image executable. The benefits of deploying a native executable are much faster start-up times and reduced
memory consumption.

This will make use of [GraalVM](https://www.graalvm.org), the [Spring Native](https://docs.spring.io/spring-native/docs/current/reference/htmlsingle/)
project and the {GraalVM Native Build Tools](https://github.com/graalvm/native-build-tools).

Our microservice will generate nonsense verse in the style of the poem Jabberwocky (by Lewis Carrol). To this remarkable
feat it uses a Markov hain to model the text of the original poem and this model is then used to generate random text 
that appear to be like the original.

# Building & Running the Java Application

This project is built using Maven. To build the application so that it can be run on-top of a JVM:

```shell
mvn clean package
```

As well as building the application packaged as a`jar`, this will also build a Docker image containing the `jar` that
uses GraalVM Enterprise Edition as the JVM.

And to run from the command line:

```shell
java -jar ./target/benchmark-jibber-0.0.1-SNAPSHOT.jar &
# Add a short sleep to allow the JVM to startup
sleep 4
# Call the endpoint
curl http://localhost:8080/jibber
# Bring the app back to the foreground - you can kill it now
fg
```

To run as a Docker container, the Docker image has been generated by running Maven:

```shell
docker run --rm --name graalce -d -p 8080:8080 jibber-benchmark:jibber.graalee.0.0.1-SNAPSHOT
```

We are going to build inside docker images - this is to allow for the fact that users of this repository
may be running on an OS other than linux. If you were to build on your native OS (Say Windows or OSX)
`native-image` would build an executable that si targeted for your OS and that wouldn't work on linux, which is how we 
are going to package and run this (inside Docker containers).

So, if you are running on OSX / Windows, you need to ensure that the VM you are using to run the Docker Daemon has sufficient
resources. We would recommend at least 4 cores and a minimum of 16GB memory.

Another thing to note is the use of the builder image. As we are building inside a docker container and are using the
maven tooling to generate the native executable, maven will need to be inside our container. WHich means that when maven
runs it will need access to the cache of dependencies. On

# Load Balancing

We use the OCI nnotation to add automatic loadbalancer adition:

https://docs.oracle.com/en-us/iaas/Content/ContEng/Tasks/contengcreatingloadbalancer.htm